{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/warn.ts", "../src/reactive.ts"],
  "sourcesContent": ["export * from './reactive'\nexport * from './effect'\n// import { isObject } from '@vue/shared'\n", "export const isObject = (v: unknown): v is Record<any, any> =>\n  typeof v === 'object' && v !== null\n", "export let activeEffect: ReactiveEffect | null\n\nfunction cleanup(effect: ReactiveEffect) {\n  const deps = effect.deps\n  for (let i = 0; i < deps.length; i++) {\n    deps[i].delete(effect)\n  }\n  effect.deps.length = 0\n  // effect.deps.forEach((dep) => {\n  //   dep.delete(effect)\n  // })\n  // effect.deps.length = 0\n}\n\nclass ReactiveEffect {\n  // is activated?\n  // if false, run collecting dependencies\n  public active = true\n  constructor(public fn) {}\n  public parent: any\n  public deps: Set<any>[] = []\n\n  run() {\n    // \u4E0D\u9700\u8981\u6536\u96C6\u4F9D\u8D56\n    if (!this.active) {\n      return this.fn()\n    }\n\n    // \u9700\u8981\u6536\u96C6\u4F9D\u8D56\n    try {\n      this.parent = activeEffect\n      activeEffect = this\n      cleanup(this)\n      return this.fn()\n    } finally {\n      activeEffect = this.parent\n      this.parent = null\n    }\n  }\n}\n\nexport function effect(fn, options = {}) {\n  // \u53EF\u4EE5\u6839\u636E\u72B6\u6001\u53D1\u751F\u53D8\u5316\uFF0C\u540C\u65F6 effect \u53EF\u4EE5\u5D4C\u5957\u3002\n  const _effect = new ReactiveEffect(fn)\n\n  _effect.run()\n}\n\nconst targetMap = new WeakMap<any, Map<string, Set<ReactiveEffect>>>()\nexport function track(target, type, key) {\n  // \u53EF\u80FD\u4E0D\u662F\u5728 effect \u4E2D\u4F7F\u7528\u3002\n  if (!activeEffect) return\n\n  let depsMap: Map<any, any> = targetMap.get(target)\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()))\n  }\n  let deps: Set<any> = depsMap.get(key)\n  if (!deps) {\n    depsMap.set(key, (deps = new Set()))\n  }\n  let shouldTrack = !deps.has(activeEffect)\n  if (shouldTrack) {\n    deps.add(activeEffect)\n    activeEffect.deps.push(deps)\n  }\n}\n\nexport function trigger(target, type, key, value, oldValue) {\n  const depsMap = targetMap.get(target)\n  if (!depsMap) return\n\n  const effects = depsMap.get(key)\n\n  if (effects) {\n    const _effects = new Set(effects)\n    _effects.forEach((effect) => {\n      if (effect !== activeEffect) effect.run()\n    })\n  }\n}\n", "import { activeEffect, track, trigger } from './effect'\n\nexport const enum ReactiveFlags {\n  IS_REACTIVE = '__v_isReactive',\n}\n\nexport const mutableHandlers = {\n  get(target, key, receiver) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true\n    }\n\n    track(target, 'get', key)\n    return Reflect.get(target, key, receiver)\n  },\n  set(target, key, value, receiver) {\n    const oldValue = target[key]\n    const res = Reflect.set(target, key, value, receiver)\n    if (value !== oldValue) {\n      trigger(target, 'set', key, value, oldValue)\n    }\n    return res\n  },\n}\n", "export function warn(msg: string, ...args: any[]) {\n  console.warn(`Vue warn ${msg}: `, ...args)\n}\n", "import { isObject } from '@vue/shared'\nimport { mutableHandlers, ReactiveFlags } from 'packages/reactivity/src/baseHandler'\nimport { warn } from './warn'\n\nconst reactiveMap = new WeakMap<any, any>()\nexport function reactive(target) {\n  if (!isObject(target)) {\n    warn('reactive', `target should be an object`)\n    return\n  }\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target\n  }\n\n  const existingProxy = reactiveMap.get(target)\n  if (existingProxy) {\n    return existingProxy\n  }\n\n  const proxy = new Proxy(target, mutableHandlers)\n\n  reactiveMap.set(target, proxy)\n  return proxy\n}\n"],
  "mappings": "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",
  "names": []
}
