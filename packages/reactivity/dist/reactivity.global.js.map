{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/warn.ts", "../src/reactive.ts", "../src/computed.ts"],
  "sourcesContent": ["export * from './reactive'\nexport * from './effect'\n// import { isObject } from '@vue/shared'\nexport * from './computed'\n", "export const isObject = (v: unknown): v is Record<any, any> =>\n  typeof v === 'object' && v !== null\n\nexport const isFunction = (v: unknown): v is Function => {\n  return typeof v === 'function'\n}\n\nexport const isString = (v: unknown): v is string => {\n  return typeof v === 'string'\n}\n\nexport const isNumber = (v: unknown): v is number => {\n  return typeof v === 'number'\n}\nexport const noop = () => {}\n", "export let activeEffect: ReactiveEffect | null\n\nfunction cleanup(effect: ReactiveEffect) {\n  const deps = effect.deps\n  for (let i = 0; i < deps.length; i++) {\n    deps[i].delete(effect)\n  }\n  effect.deps.length = 0\n  // effect.deps.forEach((dep) => {\n  //   dep.delete(effect)\n  // })\n  // effect.deps.length = 0\n}\n\nexport class ReactiveEffect {\n  // is activated?\n  // if false, run collecting dependencies\n  public active = true\n  constructor(public fn, public scheduler) {}\n  public parent: any\n  public deps: Set<any>[] = []\n\n  run() {\n    // \u4E0D\u9700\u8981\u6536\u96C6\u4F9D\u8D56\n    if (!this.active) {\n      return this.fn()\n    }\n\n    // \u9700\u8981\u6536\u96C6\u4F9D\u8D56\n    try {\n      this.parent = activeEffect\n      activeEffect = this\n      cleanup(this)\n      return this.fn()\n    } finally {\n      activeEffect = this.parent\n      this.parent = null\n    }\n  }\n  stop() {\n    if (this.active) {\n      this.active = false\n      cleanup(this)\n    }\n  }\n}\n\nexport function effect(fn, options: any = {}) {\n  // \u53EF\u4EE5\u6839\u636E\u72B6\u6001\u53D1\u751F\u53D8\u5316\uFF0C\u540C\u65F6 effect \u53EF\u4EE5\u5D4C\u5957\u3002\n  const _effect = new ReactiveEffect(fn, options.scheduler)\n  const runner = _effect.run.bind(_effect)\n  runner.effect = _effect\n\n  _effect.run()\n\n  return runner\n}\n\nconst targetMap = new WeakMap<any, Map<string, Set<ReactiveEffect>>>()\nexport function track(target, type, key) {\n  // \u53EF\u80FD\u4E0D\u662F\u5728 effect \u4E2D\u4F7F\u7528\u3002\n  if (!activeEffect) return\n\n  let depsMap: Map<any, any> = targetMap.get(target)\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()))\n  }\n  let deps: Set<any> = depsMap.get(key)\n  if (!deps) {\n    depsMap.set(key, (deps = new Set()))\n  }\n  trackEffect(deps)\n}\n\nexport function trackEffect(deps) {\n  let shouldTrack = !deps.has(activeEffect)\n  if (shouldTrack) {\n    deps.add(activeEffect)\n    activeEffect.deps.push(deps)\n  }\n}\n\nexport function trigger(target, type, key, value, oldValue) {\n  const depsMap = targetMap.get(target)\n  if (!depsMap) return\n\n  const effects = depsMap.get(key)\n\n  if (effects) {\n    triggerEffects(effects)\n  }\n}\n\nexport function triggerEffects(effects) {\n  const _effects = new Set<any>(effects)\n  _effects.forEach((effect) => {\n    if (effect !== activeEffect) {\n      if (effect.scheduler) {\n        effect.scheduler()\n      } else {\n        effect.run()\n      }\n    }\n  })\n}\n", "import { activeEffect, track, trigger } from './effect'\nimport { isObject } from '@vue/shared'\nimport { reactive } from './reactive'\n\nexport const enum ReactiveFlags {\n  IS_REACTIVE = '__v_isReactive',\n}\n\nexport const mutableHandlers = {\n  get(target, key, receiver) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true\n    }\n\n    track(target, 'get', key)\n    let res = Reflect.get(target, key, receiver)\n    if (isObject(res)) {\n      res = reactive(res)\n    }\n\n    return res\n  },\n  set(target, key, value, receiver) {\n    const oldValue = target[key]\n    const res = Reflect.set(target, key, value, receiver)\n    if (value !== oldValue) {\n      trigger(target, 'set', key, value, oldValue)\n    }\n    return res\n  },\n}\n", "export function warn(msg: string, ...args: any[]) {\n  console.warn(`Vue warn ${msg}: `, ...args)\n}\n", "import { isObject } from '@vue/shared'\nimport { mutableHandlers, ReactiveFlags } from 'packages/reactivity/src/baseHandler'\nimport { warn } from './warn'\n\nconst reactiveMap = new WeakMap<any, any>()\nexport function reactive(target) {\n  if (!isObject(target)) {\n    warn('reactive', `target should be an object`)\n    return\n  }\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target\n  }\n\n  const existingProxy = reactiveMap.get(target)\n  if (existingProxy) {\n    return existingProxy\n  }\n\n  const proxy = new Proxy(target, mutableHandlers)\n\n  reactiveMap.set(target, proxy)\n  return proxy\n}\n", "import { isFunction, noop } from '@vue/shared'\nimport { ReactiveEffect, trackEffect, triggerEffects } from '@vue/reactivity'\n\nexport function computed(\n  getterOrOption: Function | { get: Function; set: Function },\n) {\n  let getter: Function\n  let setter: Function\n  if (isFunction(getterOrOption)) {\n    getter = getterOrOption\n    setter = noop\n  } else {\n    getter = getterOrOption.get\n    setter = getterOrOption.set || noop\n  }\n  return new ComputedRefImpl(getter, setter)\n}\n\nclass ComputedRefImpl {\n  public _dirty = true\n  public _effect\n  public __v_isReadonly = true\n  public __v_isRef = true\n  public _deps = new Set()\n  public _value\n  constructor(public getter: Function, public setter: Function) {\n    this._effect = new ReactiveEffect(getter, () => {\n      if (!this._dirty) {\n        this._dirty = true\n        triggerEffects(this._deps)\n      }\n    })\n  }\n\n  get value() {\n    trackEffect(this._deps)\n    // debugger\n    if (this._dirty) {\n      this._value = this._effect.run()\n      this._dirty = false\n    }\n    return this._value\n  }\n\n  set value(newVal) {\n    this.setter(newVal)\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
